(function(){var e={916:function(e,t,o){"use strict";var n=o(5130),a=o(6768),l=o(4232);const i={class:"frame"},s={class:"header-content"},r={class:"greet"};function d(e,t,o,n,d,c){const u=(0,a.g2)("el-header"),m=(0,a.g2)("house"),p=(0,a.g2)("el-icon"),g=(0,a.g2)("el-menu-item"),h=(0,a.g2)("picture-rounded"),f=(0,a.g2)("postcard"),b=(0,a.g2)("comment"),k=(0,a.g2)("user"),_=(0,a.g2)("el-menu"),v=(0,a.g2)("el-col"),F=(0,a.g2)("el-row"),y=(0,a.g2)("el-aside"),C=(0,a.g2)("router-view"),V=(0,a.g2)("el-main"),D=(0,a.g2)("el-footer"),x=(0,a.g2)("el-container");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.bF)(x,{class:"frame-container"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{class:"header"},{default:(0,a.k6)((()=>[t[1]||(t[1]=(0,a.Lk)("a",{href:"/",class:"brand"},[(0,a.Lk)("strong",null,"Python论坛"),(0,a.eW)("管理系统")],-1)),(0,a.Lk)("div",s,[(0,a.Lk)("div",r,"欢迎"+(0,l.v_)(e.$auth.user.username)+"["+(0,l.v_)(e.$auth.user.role.name)+"]",1),(0,a.Lk)("div",{class:"signout",onClick:t[0]||(t[0]=(...e)=>c.goHome&&c.goHome(...e))},"回到首页")])])),_:1}),(0,a.bF)(x,null,{default:(0,a.k6)((()=>[(0,a.bF)(y,{width:"200px",class:"aside"},{default:(0,a.k6)((()=>[(0,a.bF)(F,{class:"menu-row"},{default:(0,a.k6)((()=>[(0,a.bF)(v,{span:24},{default:(0,a.k6)((()=>[(0,a.bF)(_,{"default-active":"1","background-color":"#545c64","active-text-color":"#fff","text-color":"#ddd",router:!0},{default:(0,a.k6)((()=>[(0,a.bF)(g,{index:"1",route:{name:"home"}},{title:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(m)])),_:1}),t[2]||(t[2]=(0,a.Lk)("span",null,"首页",-1))])),_:1}),c.has_permission("banner")?((0,a.uX)(),(0,a.Wv)(g,{key:0,index:"2",route:{name:"banner"}},{title:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(h)])),_:1}),t[3]||(t[3]=(0,a.Lk)("span",null,"轮播图",-1))])),_:1})):(0,a.Q3)("",!0),c.has_permission("post")?((0,a.uX)(),(0,a.Wv)(g,{key:1,index:"3",route:{name:"post"}},{title:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(f)])),_:1}),t[4]||(t[4]=(0,a.Lk)("span",null,"帖子管理",-1))])),_:1})):(0,a.Q3)("",!0),c.has_permission("comment")?((0,a.uX)(),(0,a.Wv)(g,{key:2,index:"4",route:{name:"comment"}},{title:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(b)])),_:1}),t[5]||(t[5]=(0,a.Lk)("span",null,"评论管理",-1))])),_:1})):(0,a.Q3)("",!0),c.has_permission("user")?((0,a.uX)(),(0,a.Wv)(g,{key:3,index:"5",route:{name:"user"}},{title:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(k)])),_:1}),t[6]||(t[6]=(0,a.Lk)("span",null,"用户管理",-1))])),_:1})):(0,a.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(x,null,{default:(0,a.k6)((()=>[(0,a.bF)(V,{class:"main"},{default:(0,a.k6)((()=>[(0,a.bF)(C)])),_:1}),(0,a.bF)(D,{class:"footer"},{default:(0,a.k6)((()=>[(0,a.eW)("© "+(0,l.v_)((new Date).getFullYear())+" Python论坛管理系统 版权所有",1)])),_:1})])),_:1})])),_:1})])),_:1})])}var c=o(941),u=o(1098),m=o(6077),p=o(460),g=o(9054),h={name:"App",components:{House:c.A,PictureRounded:u.A,Postcard:m.A,Comment:p.A,User:g.A},mounted(){this.$auth.is_staff||(window.location=this.$http.server_host)},methods:{has_permission(e){return!(!this.$auth.user||!this.$auth.user.permissions)&&this.$auth.user.permissions.indexOf(e)>=0},goHome(){window.location.href=this.$http.server_host}}},f=o(1241);const b=(0,f.A)(h,[["render",d],["__scopeId","data-v-0db19a3c"]]);var k=b,_=o(3792),v=(o(4188),o(1387));const F={id:"home"};function y(e,t,o,n,l,i){return(0,a.uX)(),(0,a.CE)("div",F,t[0]||(t[0]=[(0,a.Lk)("h1",{class:"page-title"},"首页",-1),(0,a.Lk)("div",{class:"chart-container"},[(0,a.Lk)("div",{class:"zl-chart",id:"board-post-count"}),(0,a.Lk)("div",{class:"zl-chart",id:"day7-post-count"})],-1)]))}var C=o(9671),V=o(1276),D={name:"Home",mounted(){this.loadBoardPostCountChat(),this.load7DayPostCountChat(),this.$http.getBoardPostCount().then((e=>{console.log(e)}))},methods:{loadBoardPostCountChat(){this.$http.getBoardPostCount().then((e=>{if(200==e["code"]){var t,o=e["data"],n=o["board_names"],a=o["post_counts"],l=document.getElementById("board-post-count"),i=C.Ts(l);t={title:{text:"板块帖子数",x:"center",y:"bottom"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value"},series:[{data:a,type:"bar"}]},t&&i.setOption(t)}else V.nk.error(e["message"])}))},load7DayPostCountChat(){this.$http.getDay7PostCount().then((e=>{if(200==e["code"]){var t,o=e["data"],n=o["dates"],a=o["counts"],l=document.getElementById("day7-post-count"),i=C.Ts(l);t={title:{text:"近7天帖子数",x:"center",y:"bottom"},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:n},yAxis:{type:"value",min:0,max:e=>Math.max(5,e.max),interval:1},series:[{data:a,type:"line",areaStyle:{}}]},t&&i.setOption(t)}else V.nk.error(e["message"])}))}}};const x=(0,f.A)(D,[["render",y],["__scopeId","data-v-22d263b5"]]);var L=x;const w={id:"banner",class:"banner-container"},I={class:"action-bar"},P=["src"],$=["href"],A={class:"upload-container"},U={class:"upload-tip"},W={class:"dialog-footer"},E={class:"dialog-footer"};function B(e,t,o,n,i,s){const r=(0,a.g2)("plus"),d=(0,a.g2)("el-icon"),c=(0,a.g2)("el-button"),u=(0,a.g2)("el-table-column"),m=(0,a.g2)("edit"),p=(0,a.g2)("delete"),g=(0,a.g2)("el-table"),h=(0,a.g2)("el-card"),f=(0,a.g2)("el-space"),b=(0,a.g2)("el-input"),k=(0,a.g2)("el-form-item"),_=(0,a.g2)("el-upload"),v=(0,a.g2)("el-alert"),F=(0,a.g2)("el-form"),y=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",w,[(0,a.bF)(f,{direction:"vertical",size:20,style:{width:"100%"}},{default:(0,a.k6)((()=>[t[9]||(t[9]=(0,a.Lk)("h1",{class:"page-title"},"轮播图管理",-1)),(0,a.Lk)("div",I,[(0,a.bF)(c,{type:"primary",onClick:s.onAddButtonClick,class:"add-button"},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(r)])),_:1}),t[8]||(t[8]=(0,a.eW)(" 添加轮播图 "))])),_:1},8,["onClick"])]),(0,a.bF)(h,{class:"table-card"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{data:i.banners,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#1a237e"}},{default:(0,a.k6)((()=>[(0,a.bF)(u,{prop:"name",label:"名称"}),(0,a.bF)(u,{label:"图片"},{default:(0,a.k6)((e=>[(0,a.Lk)("img",{src:s.formatImageUrl(e.row.image_url),class:"banner-image"},null,8,P)])),_:1}),(0,a.bF)(u,{label:"跳转链接"},{default:(0,a.k6)((e=>[(0,a.Lk)("a",{href:e.row.link_url,target:"_blank",class:"link-url"},(0,l.v_)(e.row.link_url),9,$)])),_:1}),(0,a.bF)(u,{prop:"priority",label:"优先级"}),(0,a.bF)(u,null,{default:(0,a.k6)((e=>[(0,a.bF)(c,{type:"primary",circle:"",onClick:t=>s.onEditEvent(e.$index),class:"action-button"},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(m)])),_:1})])),_:2},1032,["onClick"]),(0,a.bF)(c,{type:"danger",circle:"",onClick:t=>s.onDeleteEvent(e.$index),class:"action-button"},{default:(0,a.k6)((()=>[(0,a.bF)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(p)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1}),(0,a.bF)(y,{modelValue:i.bannerDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>i.bannerDialogVisible=e),title:"添加/修改轮播图",width:"30%",class:"custom-dialog"},{footer:(0,a.k6)((()=>[(0,a.Lk)("span",W,[(0,a.bF)(c,{onClick:t[4]||(t[4]=e=>i.bannerDialogVisible=!1)},{default:(0,a.k6)((()=>t[11]||(t[11]=[(0,a.eW)("取消")]))),_:1}),(0,a.bF)(c,{type:"primary",onClick:s.onDialogSubmitEvent},{default:(0,a.k6)((()=>t[12]||(t[12]=[(0,a.eW)("确认")]))),_:1},8,["onClick"])])])),default:(0,a.k6)((()=>[(0,a.bF)(F,{model:i.form,rules:i.rules,ref:"dialogForm",class:"banner-form"},{default:(0,a.k6)((()=>[(0,a.bF)(k,{label:"名称",prop:"name"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{modelValue:i.form.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.form.name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,a.bF)(k,{label:"图片",prop:"image_url"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",A,[(0,a.bF)(b,{modelValue:i.form.image_url,"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.image_url=e),autocomplete:"off",class:"image-input"},null,8,["modelValue"]),(0,a.bF)(_,{action:"/cmsapi/banner/image/upload",name:"image",headers:{Authorization:"Bearer "+e.$auth.token},"show-file-list":!1,accept:"image/jpeg, image/png, image/jpg","on-success":s.onImageUploadSuccess,"on-error":s.onImageUploadError,class:"upload-button"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{size:"small",type:"primary"},{default:(0,a.k6)((()=>t[10]||(t[10]=[(0,a.eW)("上传图片")]))),_:1})])),_:1},8,["headers","on-success","on-error"])]),(0,a.Lk)("div",U,[(0,a.bF)(v,{title:"图片要求：支持jpg、jpeg、png格式，建议尺寸1200×400像素，文件大小不超过2MB",type:"info",closable:!1,"show-icon":""})])])),_:1}),(0,a.bF)(k,{label:"跳转",prop:"link_url"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{modelValue:i.form.link_url,"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.link_url=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,a.bF)(k,{label:"优先级",prop:"priority"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{modelValue:i.form.priority,"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.priority=e),autocomplete:"off",type:"number"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),(0,a.bF)(y,{modelValue:i.deleteDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>i.deleteDialogVisible=e),title:"删除轮播图",width:"30%",class:"custom-dialog"},{footer:(0,a.k6)((()=>[(0,a.Lk)("span",E,[(0,a.bF)(c,{onClick:t[6]||(t[6]=e=>i.deleteDialogVisible=!1)},{default:(0,a.k6)((()=>t[13]||(t[13]=[(0,a.eW)("取消")]))),_:1}),(0,a.bF)(c,{type:"primary",onClick:s.onConfirmDeleteEvent},{default:(0,a.k6)((()=>t[14]||(t[14]=[(0,a.eW)("确定")]))),_:1},8,["onClick"])])])),default:(0,a.k6)((()=>[t[15]||(t[15]=(0,a.Lk)("span",null,"您确定要删除这个轮播图吗？",-1))])),_:1},8,["modelValue"])])}o(4114);var O=o(8185),S=o(6681),X=o(6150),j={name:"Banner",components:{Plus:O.A,Edit:S.A,Delete:X.A},data(){return{bannerDialogVisible:!1,deleteDialogVisible:!1,deleteingIndex:0,editingIndex:0,banners:[],form:{name:"",image_url:"",link_url:"",priority:0},rules:{name:[{required:!0,message:"请输入轮播图名称",trigger:"blur"}],image_url:[{required:!0,message:"请上传轮播图图片",trigger:"blur"}],link_url:[{required:!0,message:"请输入轮播图跳转链接",trigger:"blur"}],priority:[{required:!0,message:"请输入轮播图优先级",trigger:"blur"}]}}},mounted(){this.$http.getBannerList().then((e=>{if(200==e["code"]){let t=e["data"];this.banners=t}else V.nk.error(e["message"])})).catch((e=>{console.error("获取轮播图列表错误详情:",e),console.error("请求配置:",e.config),e.response?(console.error("错误响应数据:",e.response.data),console.error("错误状态码:",e.response.status),console.error("错误头信息:",e.response.headers),V.nk.error(`获取轮播图列表失败: 服务器返回${e.response.status}错误`)):V.nk.error("获取轮播图列表失败: "+e.message)}))},methods:{initForm(e){e?(this.form.id=e.id,this.form.name=e.name,this.form.image_url=e.image_url,this.form.link_url=e.link_url,this.form.priority=e.priority):this.form={name:"",image_url:"",link_url:"",priority:0}},formatImageUrl(e){return e?e.startsWith("http")?e:e.startsWith("/media")?this.$http.server_host+e:this.$http.server_host+"/media"+e:""},onAddButtonClick(){this.initForm(),this.bannerDialogVisible=!0},onImageUploadSuccess(e){if(200==e["code"]){var t=e["data"]["image_url"],o="/media/banner/"+t;this.form.image_url=o}},onImageUploadError(e,t,o){console.log(e),console.log(t),console.log(o)},onDialogSubmitEvent(){this.$refs["dialogForm"].validate((e=>{e?this.form.id?this.$http.editBanner(this.form).then((e=>{let t=e["code"];if(200===t){let t=e["data"];this.banners.splice(this.editingIndex,1,t),V.nk.success("轮播图编辑成功！"),this.bannerDialogVisible=!1}})):this.$http.addBanner(this.form).then((e=>{let t=e["code"];if(200===t){let t=e["data"];this.banners.push(t),V.nk.success("轮播图添加成功！"),this.bannerDialogVisible=!1}})).catch((()=>{V.nk.error("服务器开小差了，请稍后再试！"),this.bannerDialogVisible=!1})):V.nk.error("请确保数据输入正确！")}))},onEditEvent(e){this.editingIndex=e;let t=this.banners[e];this.initForm(t),this.bannerDialogVisible=!0},onDeleteEvent(e){this.deleteingIndex=e,this.deleteDialogVisible=!0},onConfirmDeleteEvent(){let e=this.banners[this.deleteingIndex];this.$http.deleteBanner(e.id).then((e=>{let t=e["code"];200===t&&(this.deleteDialogVisible=!1,this.banners.splice(this.deleteingIndex,1),V.nk.success("轮播图删除成功！"))}))}}};const z=(0,f.A)(j,[["render",B],["__scopeId","data-v-08b7a19f"]]);var T=z;const q={class:"comment-container"},H=["href"],M={class:"dialog-footer"};function R(e,t,o,n,i,s){const r=(0,a.g2)("el-table-column"),d=(0,a.g2)("delete"),c=(0,a.g2)("el-icon"),u=(0,a.g2)("el-button"),m=(0,a.g2)("el-table"),p=(0,a.g2)("el-card"),g=(0,a.g2)("el-space"),h=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",q,[(0,a.bF)(g,{direction:"vertical",size:20},{default:(0,a.k6)((()=>[t[2]||(t[2]=(0,a.Lk)("h1",{class:"page-title"},"评论管理",-1)),(0,a.bF)(p,{class:"table-card"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{data:i.comments,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#1a237e"}},{default:(0,a.k6)((()=>[(0,a.bF)(r,{prop:"content",label:"内容"}),(0,a.bF)(r,{prop:"author.username",label:"作者"}),(0,a.bF)(r,{label:"帖子"},{default:(0,a.k6)((t=>[(0,a.Lk)("a",{href:e.$http.server_host+"/post/detail/"+t.row.post.id,target:"_blank",class:"post-link"},(0,l.v_)(t.row.post.title),9,H)])),_:1}),(0,a.bF)(r,{prop:"create_time",label:"发布时间",width:"180"}),(0,a.bF)(r,{label:"操作"},{default:(0,a.k6)((e=>[(0,a.bF)(u,{type:"danger",circle:"",size:"mini",onClick:t=>s.onDeleteCommentClick(e.$index)},{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(d)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1}),(0,a.bF)(h,{modelValue:i.confirmDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>i.confirmDialogVisible=e),title:"提示",width:"30%",class:"custom-dialog"},{footer:(0,a.k6)((()=>[(0,a.Lk)("span",M,[(0,a.bF)(u,{onClick:t[0]||(t[0]=e=>i.confirmDialogVisible=!1)},{default:(0,a.k6)((()=>t[3]||(t[3]=[(0,a.eW)("取消")]))),_:1}),(0,a.bF)(u,{type:"primary",onClick:s.onConfirmDeleteCommentClick},{default:(0,a.k6)((()=>t[4]||(t[4]=[(0,a.eW)("确定")]))),_:1},8,["onClick"])])])),default:(0,a.k6)((()=>[t[5]||(t[5]=(0,a.Lk)("span",null,"您确定要删除这个评论吗？",-1))])),_:1},8,["modelValue"])])}var Q={name:"Comment",data(){return{deletingIndex:0,confirmDialogVisible:!1,comments:[]}},mounted(){this.$http.getCommentList().then((e=>{this.comments=e["data"]}))},methods:{onDeleteCommentClick(e){this.deletingIndex=e,this.confirmDialogVisible=!0},onConfirmDeleteCommentClick(){let e=this.comments[this.deletingIndex];this.$http.deleteComment(e.id).then((e=>{e&&200==e["code"]?(V.nk.success("评论删除成功！"),this.confirmDialogVisible=!1,this.comments.splice(this.deletingIndex,1)):V.nk.info(e["message"])}))}},components:{Delete:X.A}};const J=(0,f.A)(Q,[["render",R],["__scopeId","data-v-39a60268"]]);var K=J;const N={class:"post-container"},Y=["href"],G={class:"pagination-container"},Z={class:"dialog-footer"};function ee(e,t,o,n,i,s){const r=(0,a.g2)("el-table-column"),d=(0,a.g2)("delete"),c=(0,a.g2)("el-icon"),u=(0,a.g2)("el-button"),m=(0,a.g2)("el-table"),p=(0,a.g2)("el-pagination"),g=(0,a.g2)("el-card"),h=(0,a.g2)("el-space"),f=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",N,[(0,a.bF)(h,{direction:"vertical",size:20},{default:(0,a.k6)((()=>[t[2]||(t[2]=(0,a.Lk)("h1",{class:"page-title"},"帖子管理",-1)),(0,a.bF)(g,{class:"table-card"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{data:i.posts,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#1a237e"}},{default:(0,a.k6)((()=>[(0,a.bF)(r,{label:"标题"},{default:(0,a.k6)((t=>[(0,a.Lk)("a",{href:e.$http.server_host+"/post/detail/"+t.row.id,target:"_blank",class:"post-link"},(0,l.v_)(t.row.title),9,Y)])),_:1}),(0,a.bF)(r,{prop:"create_time",label:"发布时间",width:"180"}),(0,a.bF)(r,{prop:"board.name",label:"所属板块"}),(0,a.bF)(r,{prop:"author.username",label:"作者"}),(0,a.bF)(r,{label:"操作"},{default:(0,a.k6)((e=>[(0,a.bF)(u,{type:"danger",circle:"",size:"mini",onClick:t=>s.onDeletePostClick(e.$index)},{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(d)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,a.Lk)("div",G,[(0,a.bF)(p,{background:"",layout:"prev, pager, next",total:i.total_count,"current-page":i.page,onCurrentChange:s.onPageChanged},null,8,["total","current-page","onCurrentChange"])])])),_:1})])),_:1}),(0,a.bF)(f,{modelValue:i.confirmDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>i.confirmDialogVisible=e),title:"提示",width:"30%",class:"custom-dialog"},{footer:(0,a.k6)((()=>[(0,a.Lk)("span",Z,[(0,a.bF)(u,{onClick:t[0]||(t[0]=e=>i.confirmDialogVisible=!1)},{default:(0,a.k6)((()=>t[3]||(t[3]=[(0,a.eW)("取消")]))),_:1}),(0,a.bF)(u,{type:"primary",onClick:s.onConfirmDeletePostClick},{default:(0,a.k6)((()=>t[4]||(t[4]=[(0,a.eW)("确定")]))),_:1},8,["onClick"])])])),default:(0,a.k6)((()=>[t[5]||(t[5]=(0,a.Lk)("span",null,"如果删除帖子，该帖子下所有的评论也会被删除，您确定要删除吗？",-1))])),_:1},8,["modelValue"])])}var te={name:"Post",data(){return{deletingIndex:0,confirmDialogVisible:!1,posts:[],total_count:0,page:1}},mounted(){this.getPostList(1)},methods:{getPostList(e){this.$http.getPostList(e).then((e=>{if(200==e["code"]){let t=e["data"];this.posts=t["post_list"],this.total_count=t["total_count"],this.page=t["page"]}}))},onDeletePostClick(e){this.confirmDialogVisible=!0,this.deletingIndex=e},onConfirmDeletePostClick(){let e=this.posts[this.deletingIndex];this.$http.deletePost(e.id).then((e=>{200==e["code"]?(this.posts.splice(this.deletingIndex,1),V.nk.success("帖子删除成功！"),this.confirmDialogVisible=!1):V.nk.info(e["message"])}))},onPageChanged(e){this.getPostList(e)}},components:{Delete:X.A}};const oe=(0,f.A)(te,[["render",ee],["__scopeId","data-v-0897bc7b"]]);var ne=oe;const ae={class:"user-container"},le={class:"dialog-footer"};function ie(e,t,o,n,i,s){const r=(0,a.g2)("el-table-column"),d=(0,a.g2)("el-tag"),c=(0,a.g2)("delete"),u=(0,a.g2)("el-icon"),m=(0,a.g2)("el-button"),p=(0,a.g2)("el-table"),g=(0,a.g2)("el-card"),h=(0,a.g2)("el-space"),f=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.CE)("div",ae,[(0,a.bF)(h,{direction:"vertical",size:20},{default:(0,a.k6)((()=>[t[6]||(t[6]=(0,a.Lk)("h1",{class:"page-title"},"用户管理",-1)),(0,a.bF)(g,{class:"table-card"},{default:(0,a.k6)((()=>[(0,a.bF)(p,{data:i.users,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa",color:"#1a237e"}},{default:(0,a.k6)((()=>[(0,a.bF)(r,{prop:"username",label:"用户名"}),(0,a.bF)(r,{prop:"email",label:"邮箱"}),(0,a.bF)(r,{prop:"join_time",label:"加入时间"}),(0,a.bF)(r,{label:"员工"},{default:(0,a.k6)((e=>[e.row.is_staff?((0,a.uX)(),(0,a.Wv)(d,{key:0,type:"success",effect:"dark"},{default:(0,a.k6)((()=>t[2]||(t[2]=[(0,a.eW)("是")]))),_:1})):((0,a.uX)(),(0,a.Wv)(d,{key:1,type:"danger",effect:"plain"},{default:(0,a.k6)((()=>t[3]||(t[3]=[(0,a.eW)("否")]))),_:1}))])),_:1}),(0,a.bF)(r,{label:"状态"},{default:(0,a.k6)((e=>[e.row.is_active?((0,a.uX)(),(0,a.Wv)(d,{key:0,type:"success",effect:"dark"},{default:(0,a.k6)((()=>t[4]||(t[4]=[(0,a.eW)("是")]))),_:1})):((0,a.uX)(),(0,a.Wv)(d,{key:1,type:"danger",effect:"plain"},{default:(0,a.k6)((()=>t[5]||(t[5]=[(0,a.eW)("否")]))),_:1}))])),_:1}),(0,a.bF)(r,{label:"操作"},{default:(0,a.k6)((e=>[(0,a.bF)(m,{type:"danger",circle:"",size:"mini",onClick:t=>s.onActiveUserClick(e.$index)},{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1}),(0,a.bF)(f,{modelValue:i.confirmDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>i.confirmDialogVisible=e),title:"提示",width:"30%",class:"custom-dialog"},{footer:(0,a.k6)((()=>[(0,a.Lk)("span",le,[(0,a.bF)(m,{onClick:t[0]||(t[0]=e=>i.confirmDialogVisible=!1)},{default:(0,a.k6)((()=>t[7]||(t[7]=[(0,a.eW)("取消")]))),_:1}),(0,a.bF)(m,{type:"primary",onClick:s.onConfirmActiveUserClick},{default:(0,a.k6)((()=>t[8]||(t[8]=[(0,a.eW)("确定")]))),_:1},8,["onClick"])])])),default:(0,a.k6)((()=>[(0,a.Lk)("span",null,(0,l.v_)(i.message),1)])),_:1},8,["modelValue"])])}var se={name:"User",data(){return{confirmDialogVisible:!1,users:[],activingIndex:0,message:""}},mounted(){this.getUserList(1)},methods:{getUserList(e){this.$http.getUserList(e).then((e=>{this.users=e.data}))},onActiveUserClick(e){this.activingIndex=e,this.confirmDialogVisible=!0;const t=this.users[e];t.is_active?this.message="您确定要拉黑此用户吗？":this.message="您确定要取消拉黑此用户吗？"},onConfirmActiveUserClick(){let e=this.users[this.activingIndex],t=e.is_active?0:1;this.$http.activeUser(e.id,t).then((e=>{if(e&&200==e["code"]){V.nk.success("操作成功！"),this.confirmDialogVisible=!1;let t=e.data;this.users.splice(this.activingIndex,1,t)}else V.nk.info("操作失败！"),this.confirmDialogVisible=!1}))}},components:{Delete:X.A}};const re=(0,f.A)(se,[["render",ie],["__scopeId","data-v-532080f9"]]);var de=re;const ce=[{path:"/",component:L,name:"home"},{path:"/banner",component:T,name:"banner"},{path:"/comment",component:K,name:"comment"},{path:"/post",component:ne,name:"post"},{path:"/user",component:de,name:"user"}],ue=(0,v.aE)({history:(0,v.Bt)(),routes:ce});var me=ue;const pe="USER_KEY",ge="JWT_TOKEN_KEY";class he{constructor(){this.token=null,this.user=null,this.token=localStorage.getItem(ge);const e=localStorage.getItem(pe);e&&(this.user=JSON.parse(e),this.user.permissions||(this.user.permissions=[]))}static getInstance(){return this._instance||(this._instance=new he),this._instance}setUserToken(e,t){this.user=e,this.token=t,localStorage.setItem(pe,JSON.stringify(e)),localStorage.setItem(ge,t)}clearUserToken(){this.user=null,this.token=null,localStorage.removeItem(pe),localStorage.removeItem(ge)}get is_authed(){return!(!this.user||!this.token)}get is_staff(){return!!this.is_authed&&!!this.user.is_staff}}var fe=he.getInstance(),be=o(4373),ke=o(9122),_e=o.n(ke);class ve{constructor(){this.server_host="undefined"!==typeof window?window.location.origin:"http://www.abc.net",this.http=be.A.create({baseURL:"/cmsapi",timeout:6e4}),this.http.interceptors.request.use((e=>{const t=fe.token;return t&&(e.headers.Authorization="Bearer "+t),e.headers["X-Requested-With"]="XMLHttpRequest",e})),this.http.interceptors.response.use((e=>e.data),(e=>(e.response?console.error("请求失败:",e.response.status):console.error("网络错误:",e.message),Promise.reject(e))))}_post(e,t){return this.http.post(e,_e().stringify(t))}addBanner(e){const t="/banner/add";return this._post(t,e)}getBannerList(){const e="/banner/list";return this.http.get(e)}deleteBanner(e){const t="/banner/delete";return this._post(t,{id:e})}editBanner(e){const t="/banner/edit";return this._post(t,e)}getPostList(e){const t="/post/list?page="+(e||1);return this.http.get(t)}deletePost(e){const t="/post/delete";return this._post(t,{id:e})}getCommentList(){const e="/comment/list";return this.http.get(e)}deleteComment(e){const t="/comment/delete";return this._post(t,{id:e})}getUserList(e){const t="/user/list?page="+e;return this.http.get(t)}activeUser(e,t){const o="/user/active";return this._post(o,{id:e,is_active:t})}getBoardPostCount(){const e="/board/post/count";return this.http.get(e)}getDay7PostCount(){const e="/day7/post/count";return this.http.get(e)}upload(e,t){return this.http.post(e,t,{headers:{"Content-Type":"multipart/form-data"}})}}var Fe=new ve;const ye=(0,n.Ef)(k);ye.use(_.A),ye.use(me),ye.config.globalProperties.$auth=fe,ye.config.globalProperties.$http=Fe,ye.mount("#app")},2634:function(){}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var l=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(l.exports,l,l.exports,o),l.loaded=!0,l.exports}o.m=e,function(){var e=[];o.O=function(t,n,a,l){if(!n){var i=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],l=e[c][2];for(var s=!0,r=0;r<n.length;r++)(!1&l||i>=l)&&Object.keys(o.O).every((function(e){return o.O[e](n[r])}))?n.splice(r--,1):(s=!1,l<i&&(i=l));if(s){e.splice(c--,1);var d=a();void 0!==d&&(t=d)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[n,a,l]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,l,i=n[0],s=n[1],r=n[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(a in s)o.o(s,a)&&(o.m[a]=s[a]);if(r)var c=r(o)}for(t&&t(n);d<i.length;d++)l=i[d],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(c)},n=self["webpackChunkzlbbs_cms"]=self["webpackChunkzlbbs_cms"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(916)}));n=o.O(n)})();